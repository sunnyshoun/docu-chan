{
    "name": "designer_structure",
    "description": "Generate detailed structure logic for Mermaid flowchart based on TPA analysis",
    "version": "1.1.0",
    "system_prompt": "You are a Mermaid diagram architect. Design flowcharts with STRICT top-to-bottom structure. The nodes array order determines the visual layout - START must be first, END must be last.",
    "user_prompt_template": "Design a Mermaid flowchart structure based on this analysis:\n\n<tpa_analysis>\n{tpa_analysis}\n</tpa_analysis>\n\n<original_request>\n{user_request}\n</original_request>\n\n=== CRITICAL STRUCTURE RULES ===\n\n1. **NODE ORDER = VISUAL ORDER**\n   - The `nodes` array order determines top-to-bottom layout\n   - FIRST node = TOP of diagram (always START)\n   - LAST node = BOTTOM of diagram (always END)\n   - Order nodes by their logical flow sequence\n\n2. **APPROPRIATE COMPLEXITY**\n   - Match complexity to user's request (simple request = fewer nodes, detailed request = more nodes)\n   - Avoid subgraphs unless the user explicitly wants grouped sections\n   - Use concise labels that clearly describe each step\n\n3. **DECISION BRANCHES**\n   - Place decision nodes at branch points\n   - Keep branch depth manageable for readability\n\n4. **SINGLE START, SINGLE END**\n   - Only ONE start node at the TOP\n   - Only ONE end node at the BOTTOM\n   - All paths must converge to the end node\n\nProvide your response in JSON format:\n\n```json\n{\n    \"diagram_type\": \"flowchart\",\n    \"direction\": \"TD\",\n    \"nodes\": [\n        {\"id\": \"start\", \"label\": \"Start\", \"type\": \"start\", \"shape\": \"stadium\"},\n        {\"id\": \"step1\", \"label\": \"First Step\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"decision1\", \"label\": \"Condition?\", \"type\": \"decision\", \"shape\": \"diamond\"},\n        {\"id\": \"step2a\", \"label\": \"Yes Path\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"step2b\", \"label\": \"No Path\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"end_node\", \"label\": \"End\", \"type\": \"end\", \"shape\": \"stadium\"}\n    ],\n    \"edges\": [\n        {\"from\": \"start\", \"to\": \"step1\"},\n        {\"from\": \"step1\", \"to\": \"decision1\"},\n        {\"from\": \"decision1\", \"to\": \"step2a\", \"label\": \"Yes\"},\n        {\"from\": \"decision1\", \"to\": \"step2b\", \"label\": \"No\"},\n        {\"from\": \"step2a\", \"to\": \"end_node\"},\n        {\"from\": \"step2b\", \"to\": \"end_node\"}\n    ],\n    \"subgraphs\": [],\n    \"styling\": {\n        \"theme\": \"default\",\n        \"node_colors\": {\n            \"startNode\": \"#90EE90\",\n            \"endNode\": \"#FFB6C1\",\n            \"decision\": \"#FFD700\",\n            \"process\": \"#87CEEB\"\n        }\n    }\n}\n```\n\nProvide only the JSON response.",
    "parameters": {
        "temperature": 0.3,
        "max_tokens": 4096
    },
    "input_variables": ["tpa_analysis", "user_request"],
    "output_format": "json"
}
