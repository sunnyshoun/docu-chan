{
    "name": "designer_structure",
    "description": "Generate detailed structure logic for Mermaid flowchart based on TPA analysis",
    "version": "1.2.0",
    "system_prompt": "You are a Mermaid diagram architect. Design flowcharts with STRICT top-to-bottom structure. Support 1-to-many (fan-out) and many-to-1 (fan-in) patterns for parallel/delegation flows.",
    "user_prompt_template": "Design a Mermaid flowchart structure based on this analysis:\n\n<tpa_analysis>\n{tpa_analysis}\n</tpa_analysis>\n\n<original_request>\n{user_request}\n</original_request>\n\n=== CRITICAL STRUCTURE RULES ===\n\n1. **NODE ORDER = VISUAL ORDER**\n   - The `nodes` array order determines top-to-bottom layout\n   - FIRST node = TOP of diagram (always START)\n   - LAST node = BOTTOM of diagram (always END)\n   - Order nodes by their logical flow sequence\n\n2. **1-TO-MANY (FAN-OUT) PATTERNS**\n   - When a node delegates to multiple workers/agents, create separate edges to each target\n   - Example: main_agent -> [worker1, worker2, worker3]\n   - Use clear labels on edges to show the relationship\n   - Group parallel workers at the same level visually\n\n3. **MANY-TO-1 (FAN-IN) PATTERNS**\n   - Multiple nodes can converge back to a single node\n   - Example: [worker1, worker2, worker3] -> aggregator\n   - All parallel paths should merge properly\n\n4. **APPROPRIATE COMPLEXITY**\n   - Match complexity to user's request\n   - Avoid subgraphs unless explicitly needed\n   - Use concise labels that clearly describe each step\n\n5. **SINGLE START, SINGLE END**\n   - Only ONE start node at the TOP\n   - Only ONE end node at the BOTTOM\n   - All paths must converge to the end node\n\n6. **NODE SHAPES** - Choose appropriate shape for each node type:\n   - START/END: Use `stadium` shape ([text])\n   - Process/Action: Use `rectangle` shape [text]\n   - Decision/Condition: Use `diamond` shape {text}\n   - Input/Output: Use `parallelogram` shape [/text/]\n   - Database/Storage: Use `cylinder` shape [(text)]\n   - Event/Connector: Use `circle` shape ((text))\n   - Subprocess: Use `subroutine` shape [[text]]\n   - Manual Operation: Use `hexagon` shape {{text}}\n\nProvide your response in JSON format:\n\n```json\n{\n    \"diagram_type\": \"flowchart\",\n    \"direction\": \"TD\",\n    \"nodes\": [\n        {\"id\": \"start\", \"label\": \"Start\", \"type\": \"start\", \"shape\": \"stadium\"},\n        {\"id\": \"main\", \"label\": \"Main Agent\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"decision1\", \"label\": \"Need Workers?\", \"type\": \"decision\", \"shape\": \"diamond\"},\n        {\"id\": \"worker1\", \"label\": \"Worker 1\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"worker2\", \"label\": \"Worker 2\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"worker3\", \"label\": \"Worker 3\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"collect\", \"label\": \"Collect Results\", \"type\": \"process\", \"shape\": \"rectangle\"},\n        {\"id\": \"db_save\", \"label\": \"Save to DB\", \"type\": \"database\", \"shape\": \"cylinder\"},\n        {\"id\": \"end_node\", \"label\": \"End\", \"type\": \"end\", \"shape\": \"stadium\"}\n    ],\n    \"shape_reference\": {\n        \"stadium\": \"([text]) for START/END\",\n        \"rectangle\": \"[text] for process\",\n        \"diamond\": \"{text} for decision\",\n        \"cylinder\": \"[(text)] for database\",\n        \"parallelogram\": \"[/text/] for input/output\",\n        \"circle\": \"((text)) for event\",\n        \"subroutine\": \"[[text]] for subprocess\",\n        \"hexagon\": \"{{text}} for manual op\"\n    },\n    \"edges\": [\n        {\"from\": \"start\", \"to\": \"main\"},\n        {\"from\": \"main\", \"to\": \"worker1\", \"label\": \"delegate\"},\n        {\"from\": \"main\", \"to\": \"worker2\", \"label\": \"delegate\"},\n        {\"from\": \"main\", \"to\": \"worker3\", \"label\": \"delegate\"},\n        {\"from\": \"worker1\", \"to\": \"collect\", \"label\": \"result\"},\n        {\"from\": \"worker2\", \"to\": \"collect\", \"label\": \"result\"},\n        {\"from\": \"worker3\", \"to\": \"collect\", \"label\": \"result\"},\n        {\"from\": \"collect\", \"to\": \"end_node\"}\n    ],\n    \"subgraphs\": [],\n    \"styling\": {\n        \"theme\": \"default\",\n        \"node_colors\": {\n            \"startNode\": \"#90EE90\",\n            \"endNode\": \"#FFB6C1\",\n            \"decision\": \"#FFD700\",\n            \"process\": \"#87CEEB\"\n        }\n    }\n}\n```\n\nProvide only the JSON response.",
    "parameters": {
        "temperature": 0.3,
        "max_tokens": 4096
    },
    "input_variables": ["tpa_analysis", "user_request"],
    "output_format": "json"
}
